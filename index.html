<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaspi Game - Full Edition</title>
    <style>
        :root {
            --kaspi-red: #f14635;
            --kaspi-blue: #0089d0;
            --bg-gray: #f2f2f5;
            --text-dark: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #ccc;
            margin: 0;
            display: flex;
            justify-content: center;
        }

        #app {
            width: 100%;
            max-width: 450px;
            background: var(--bg-gray);
            min-height: 100vh;
            position: relative;
        }

        /* Screens */
        .screen { display: none; flex-direction: column; height: 100vh; }
        .active { display: flex; }

        /* Auth */
        .auth-container { background: white; padding: 40px 20px; height: 100%; text-align: center; }
        .logo { color: var(--kaspi-red); font-size: 35px; font-weight: bold; margin-bottom: 30px; }

        /* Inputs & Buttons */
        input, select {
            padding: 15px; margin: 8px 0; border: 1px solid #ddd;
            border-radius: 10px; font-size: 16px; width: 85%; outline: none;
        }
        .btn-main {
            background: var(--kaspi-blue); color: white; border: none;
            padding: 15px; border-radius: 10px; font-weight: bold; width: 93%; cursor: pointer;
        }

        /* Header */
        .header { background: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; }
        
        /* Balance Card */
        .card {
            background: white; margin: 15px; padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .balance-val { font-size: 30px; font-weight: bold; color: var(--text-dark); }

        /* Menu */
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; }
        .menu-item { background: white; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; font-size: 12px; font-weight: 500; }
        .icon { font-size: 24px; margin-bottom: 5px; display: block; }

        /* Modals (Custom UI) */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: flex-end;
        }
        .modal-ui {
            background: white; width: 100%; max-width: 450px; border-radius: 20px 20px 0 0;
            padding: 25px; box-sizing: border-box; animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .error-msg { color: var(--kaspi-red); font-size: 13px; margin-top: 5px; display: none; }
        .success-anim { color: #4caf50; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

<div id="app">
    <div id="authScreen" class="screen auth-container">
        <div class="logo">Kaspi.kz</div>
        <h2>–¢—ñ—Ä–∫–µ–ª—É</h2>
        <input type="number" id="regPhone" placeholder="7XXXXXXXXXX">
        <input type="password" id="regPass" placeholder="“ö“±–ø–∏—è —Å”©–∑ (3-16)">
        <button class="btn-main" onclick="register()">–ê–∫–∫–∞—É–Ω—Ç –∞—à—É</button>
    </div>

    <div id="mainScreen" class="screen">
        <div class="header">
            <b style="color: var(--kaspi-red)">Kaspi.kz</b>
            <span id="displayPhone" style="font-size: 13px; color: #777;"></span>
        </div>
        
        <div class="card">
            <div style="color: #888; font-size: 14px;">Kaspi Gold</div>
            <div class="balance-val"><span id="balance">0</span> ‚Ç∏</div>
        </div>

        <div class="menu-grid">
            <div class="menu-item" onclick="showModal('transferModal')">
                <span class="icon" style="color: var(--kaspi-blue)">‚áÑ</span> –ü–µ—Ä–µ–≤–æ–¥
            </div>
            <div class="menu-item" onclick="showModal('creditModal')">
                <span class="icon" style="color: #4caf50">üí∞</span> –ö—Ä–µ–¥–∏—Ç
            </div>
            <div class="menu-item" onclick="alert('–ñ–∞“õ—ã–Ω–¥–∞...')">
                <span class="icon" style="color: #ff9800">üì¶</span> –ú–∞–≥–∞–∑–∏–Ω
            </div>
        </div>
    </div>
</div>

<div id="transferModal" class="modal-overlay">
    <div class="modal-ui">
        <h3>–ê—É–¥–∞—Ä—É</h3>
        <input type="number" id="toPhone" placeholder="–ö—ñ–º–≥–µ (7XXXXXXXXXX)">
        <input type="number" id="toAmount" placeholder="–°–æ–º–º–∞ ‚Ç∏">
        <div id="transferError" class="error-msg">–ù”©–º—ñ—Ä “õ–∞—Ç–µ –Ω–µ–º–µ—Å–µ “õ–∞—Ä–∞–∂–∞—Ç –∞–∑!</div>
        <button class="btn-main" onclick="doTransfer()">–ñ—ñ–±–µ—Ä—É</button>
        <button class="btn-main" style="background:#eee; color:#333; margin-top:10px" onclick="hideModal('transferModal')">–ñ–∞–±—É</button>
    </div>
</div>

<div id="creditModal" class="modal-overlay">
    <div class="modal-ui">
        <h3>–ö—Ä–µ–¥–∏—Ç –∞–ª—É</h3>
        <input type="number" id="credAmount" placeholder="–°–æ–º–º–∞ (1000 - 500000)" min="1000" max="500000">
        <select id="credTerm">
            <option value="1">1 —Å–∞“ì–∞—Ç (5% –∫–æ–º–∏—Å—Å–∏—è)</option>
            <option value="24">1 –∫“Ø–Ω (10% –∫–æ–º–∏—Å—Å–∏—è)</option>
            <option value="120">5 –∫“Ø–Ω (20% –∫–æ–º–∏—Å—Å–∏—è)</option>
        </select>
        <div id="credInfo" style="font-size: 12px; margin: 10px 0; color: #666;"></div>
        <button class="btn-main" style="background:var(--kaspi-red)" onclick="takeCredit()">–ê–ª—É</button>
        <button class="btn-main" style="background:#eee; color:#333; margin-top:10px" onclick="hideModal('creditModal')">–ñ–∞–±—É</button>
    </div>
</div>

<script>
    let user = null;
    const USERS_DB = 'kaspi_game_users'; // –ë–∞—Ä–ª—ã“õ —Ç—ñ—Ä–∫–µ–ª–≥–µ–Ω–¥–µ—Ä —Ç—ñ–∑—ñ–º—ñ

    window.onload = () => {
        const saved = localStorage.getItem('current_session');
        if (saved) {
            user = JSON.parse(saved);
            loadMain();
        } else {
            document.getElementById('authScreen').classList.add('active');
        }
    };

    function register() {
        const ph = document.getElementById('regPhone').value;
        const ps = document.getElementById('regPass').value;

        if (ph.length !== 11) return alert("–ù”©–º—ñ—Ä 11 —Å–∞–Ω –±–æ–ª—É—ã –∫–µ—Ä–µ–∫!");
        if (ps.length < 3 || ps.length > 16) return alert("–ü–∞—Ä–æ–ª—å “±–∑—ã–Ω–¥—ã“ì—ã “õ–∞—Ç–µ!");

        let allUsers = JSON.parse(localStorage.getItem(USERS_DB) || "[]");
        
        if (allUsers.find(u => u.phone === ph)) {
            alert("–ë“±–ª –Ω”©–º—ñ—Ä —Ç—ñ—Ä–∫–µ–ª–≥–µ–Ω! –ë–∞—Å“õ–∞ –Ω”©–º—ñ—Ä –∂–∞–∑—ã“£—ã–∑.");
            return;
        }

        user = { phone: ph, pass: ps, balance: 50000 }; // –°—Ç–∞—Ä—Ç—Ç—ã“õ 50–∫
        allUsers.push(user);
        localStorage.setItem(USERS_DB, JSON.stringify(allUsers));
        localStorage.setItem('current_session', JSON.stringify(user));
        loadMain();
    }

    function loadMain() {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('mainScreen').classList.add('active');
        document.getElementById('displayPhone').innerText = "+" + user.phone;
        document.getElementById('balance').innerText = user.balance.toLocaleString();
    }

    function showModal(id) { document.getElementById(id).style.display = 'flex'; }
    function hideModal(id) { document.getElementById(id).style.display = 'none'; }

    function doTransfer() {
        const targetPh = document.getElementById('toPhone').value;
        const amount = parseInt(document.getElementById('toAmount').value);
        const err = document.getElementById('transferError');
        
        let allUsers = JSON.parse(localStorage.getItem(USERS_DB) || "[]");
        const targetExist = allUsers.find(u => u.phone === targetPh);

        if (!targetExist || targetPh === user.phone || amount > user.balance || !amount) {
            err.style.display = 'block';
            err.innerText = "“ö–∞—Ç–µ: –ù”©–º—ñ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã –Ω–µ–º–µ—Å–µ ”©–∑ –Ω”©–º—ñ—Ä—ñ“£—ñ–∑!";
            return;
        }

        user.balance -= amount;
        updateUserInDB();
        err.style.display = 'none';
        alert("–ê“õ—à–∞ —Å”ô—Ç—Ç—ñ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!");
        hideModal('transferModal');
        loadMain();
    }

    function takeCredit() {
        const amt = parseInt(document.getElementById('credAmount').value);
        if (amt < 1000 || amt > 500000 || !amt) {
            alert("–°–æ–º–º–∞ 1000 - 500 000 –∞—Ä–∞—Å—ã–Ω–¥–∞ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫");
            return;
        }

        user.balance += amt;
        updateUserInDB();
        alert("–ö—Ä–µ–¥–∏—Ç –º–∞“õ“±–ª–¥–∞–Ω–¥—ã! –ê“õ—à–∞ –±–∞–ª–∞–Ω—Å“õ–∞ —Ç“Ø—Å—Ç—ñ.");
        hideModal('creditModal');
        loadMain();
    }

    function updateUserInDB() {
        let allUsers = JSON.parse(localStorage.getItem(USERS_DB) || "[]");
        const idx = allUsers.findIndex(u => u.phone === user.phone);
        allUsers[idx] = user;
        localStorage.setItem(USERS_DB, JSON.stringify(allUsers));
        localStorage.setItem('current_session', JSON.stringify(user));
    }
</script>

</body>
</html>

